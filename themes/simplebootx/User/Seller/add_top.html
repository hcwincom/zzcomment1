<tc_include file="Public/user_head" />
<div class="per_right rt">
    <div class="dynamic_main">
        <div class="per_rnav">
            <a class="rb" href="javascript:void(0);">推荐位购买</a>
        </div>
        <form action="{:U('add_top_do')}" method="POST" id="recommend" name="playlist">
            <div class="form3">
                <span class="lf">周期</span>
                <ul class="playtime">
                <foreach name="top_sellers" item="vo">
                    <li>
                        <span class="span{$key}"></span>
                        <div><span>¥<i id="price{$key}">{$vo.price}</i>元/天</span></div>
                        <div>
                           <p>已生效：
                           <empty name="vo.start">
                           		<span>无</span>
                           <else/>
                           		<span>{$vo['start']['start_time']|date='Y.m.d',###}</span>-
                           		<span>{$vo['start']['end_time']|date='Y.m.d',###}</span>
                           </empty>
                           </p>
                        </div>
                        <div>
                           <p> 即将生效:
							<empty name="vo.end">
                           		<span>无</span>
                           <else/>
                           		<span>{$vo['end']['start_time']|date='Y.m.d',###}</span>-
                           		<span>{$vo['end']['end_time']|date='Y.m.d',###}</span>
                           </empty>
						</p>
                        </div>
                    </li>
                  </foreach>
                     
                </ul>
                
            </div>
            <div class="form3">
                <span class="lf">时间</span>
                <ul class="form3_list1 lf">
                    <li>
                        <div class="date-sjk">
                            <input name="start" class="inline laydate-icon" id="start1" readonly>
                        </div>
                    </li>
                    <li>
                        <div class="date-sjk">
                          至  <input name="start" class="inline laydate-icon" id="start2" readonly>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="form3"><span>总价：</span><i id="price2">100</i>元</div>
            <div class="form3"><input type="submit" value="购买"></div>
        </form>

    </div>
</div>
  <script type="text/javascript" src="__TMPL__Public/js/laydate.js"></script>    
<tc_include file="Public/user_footer" />
<script>
$('#recommend').submit(function(){
	var sid='{$info.id}';
	var start0=$.trim($("#start1").val());
	var end0=$.trim($("#start2").val());
    var date_start=new Date(start0).getTime()/1000/60/60/24;
    var date_end=new Date(end0).getTime()/1000/60/60/24;
    if(!(date_end-date_start>=1)){
        alert("置顶时间最少为1天");
        return false;
    } 
    var zprice=$('#price2').text();
    var site=1;
    var id="{$info.id}";
    $.post("{:U('add_top_do')}",{'sid':sid,'start':start0,'end':end0,'zprice':zprice,'site':1},function(data){
    	alert(data.info);
		if(data.status==1){ 
			//location.href=data.url;
		} 	
	},'json');
	return false;
	 
	return false;
});
!function(){
    laydate.skin('molv');//切换皮肤，请查看skins下面皮肤库
 //    laydate({elem: '#demo'});//绑定元素
}();
//日期范围限制
var start = {
    elem: '#start1',
    format: 'YYYY-MM-DD',
    min: laydate.now(), //设定最小日期为当前日期
    max:'', //最大日期
    istime: false,
    istoday: true,
    choose: function(datas){
         
         datas = new Date(new Date(datas).getTime() + (1000 * 60 * 60 * 24));
         datas = datas.getFullYear() + "-" + (datas.getMonth() + 1) + "-" + datas.getDate(); //重新格式化

         end.min = datas; //开始日选好后，重置结束日的最小日期
         end.start = datas; //将结束日的初始值设定为开始日
         editprice();
    }
};

laydate(start);  
var end = {
    elem: '#start2',
    format: 'YYYY-MM-DD',
    min: laydate.now(+1), //设定最小日期为当前日期
    max:'', //最大日期
    istime: false,
     istoday: false,
    choose: function(datas){ 
          editprice();
    }
};
laydate(end);  
function editprice() {
	return 0;
 var start0 = $.trim($("#start1").val()); 
 var end0 = $.trim($("#start2").val()); 
 if (start == '' || end == '' || start0.length == 0 || end0.length == 0) {
     return false;
 }
 var date_start = (new Date(start0).getTime()) / 1000 / 60 / 60 / 24; 
 var date_end = (new Date(end0).getTime()) / 1000 / 60 / 60 / 24; 
 var days = date_end - date_start;
 var zprice = 0;
 if (days >= 1) { 
     var price = parseFloat($('#price1').text());
    zprice = (price * days).toFixed(2); 
 }  
 $('#price2').text(zprice); 
 $('#zprice').val(zprice);    
}
</script>